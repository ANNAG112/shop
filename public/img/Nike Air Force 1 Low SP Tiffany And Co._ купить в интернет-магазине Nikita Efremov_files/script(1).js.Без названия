jQuery.noConflict();
(function($){
    $(function(){

        let w_h = $(window).height();
        let w_w = $(window).width();
        let w_p;

        let menuBlock = document.getElementById('menu');
        show_jq_hidden();

        $(window).resize(function(){
            w_w = $(window).width();
            w_h = $(window).height();

            // if ($('.menu-ctrls-block').length) {
            //     menu_bottom_bar ();
            // }
        });

        window.addEventListener("scroll", function(){
            show_jq_hidden();

            w_p = $(window).scrollTop();

            color_menu();

        });

        function show_jq_hidden() {
            $('.jq_hidden').each(function(){
                let scroll_pos = window.pageYOffset;
                if ($(this).offset().top - 150 < scroll_pos + $(window).height()) {
                    $(this).addClass('jq_active');
                }
                if ($(this).offset().top > scroll_pos + $(window).height()) {
                    $(this).removeClass('jq_active');
                }
            });
        }


        $('.menu-btn').click(function () {
            $(this).toggleClass('active');
            $('#menu').toggleClass('active');
            $('body').toggleClass('lock-scroll');
            $('#drop_menu_block').find('.dropdown-menu.active').removeClass('active');

        });

        function color_menu() {
            let scroll_pos = window.pageYOffset;
            if (scroll_pos > 30) {
                $('#menu').addClass('no-transparent');
            } else {
                $('#menu').removeClass('no-transparent');
            }

        }

        color_menu();

        // function menu_bottom_bar () {
        //     let $bottom_bar = $('.menu-ctrls-block');
        //     if (w_w < 960 && $(document).find('#menu .menu-ctrls-block').length) {
        //         $(document).find('.menu-ctrls-block').remove();
        //         $('body').append($bottom_bar);
        //     }
        //
        //     if (w_w > 960 && !$(document).find('#menu .menu-ctrls-block').length) {
        //         $(document).find('.menu-ctrls-block').remove();
        //         $('#menu .wrapper').append($bottom_bar);
        //     }
        //
        // }

        // if ($('.menu-ctrls-block').length) {
        //     menu_bottom_bar ();
        // }

        $(document).on('initFilterAccordeon', function () {
          $('.acc-head').click(function (event) {
            event.stopPropagation();
            let $accordeon = $(this).parent();
            $accordeon.toggleClass('active');
            $accordeon.find('.miniatures-container').slideToggle('slow');
            $accordeon.children('.acc-body').slideToggle('slow');
          });
        });
        $(document).trigger('initFilterAccordeon');

        $('.mobile-acc-head').click(function (event) {
            let w_w = $(window).width();

            if (w_w < 960) {
                event.stopPropagation();
                let $accordeon = $(this).parents('.mobile-acc-block');
                $accordeon.toggleClass('active');
                $accordeon.children('.mobile-acc-body').slideToggle('slow');
            }
        });

        if ($('.custom-drop').length) {
            custon_dropdown();
        }

        function custon_dropdown() {
            $('.custom-drop').each(function () {
                let $parent = $(this);
                let $select = $parent.find('select');
                let select_leng = $select.find('option').length;

                $parent.append("<div class='custom-dropdown'><div class='current'></div><ul class='drop-list'></ul></div>");

                let $drop_current = $parent.find('.current');
                let $drop_list = $parent.find('.drop-list');
                let current_i = $select.find("option:selected").index();

                $drop_current.text($select.find('option').eq(current_i).text());


                for (let i = 0; i < select_leng; i++ ) {

                    let $option = $select.find('option').eq(i)

                    let opt_text = $option.text();

                    if ($option.hasClass('new_price')) {
                        opt_text = opt_text + '<span class="new-price-span">' + $option.data('text') +  '<b>' + $option.data('price') +'</b></span>';
                    }

                    if (i == current_i) {
                        $drop_list.append('<li class="active">' + opt_text + '</li>');
                    } else {
                        $drop_list.append('<li>' + opt_text + '</li>');
                    }
                }

                $drop_current.click(function (event) {
                    event.stopPropagation();

                    if ($(this).hasClass('active')) {
                        $('body').find('.custom-dropdown').find('.current').removeClass('active');
                        $('body').find('.custom-dropdown').find('.drop-list').slideUp();
                    } else {
                        $('body').find('.custom-dropdown').find('.current').removeClass('active');
                        $('body').find('.custom-dropdown').find('.drop-list').slideUp();
                        $(this).addClass('active');
                        $(this).parent().find('.drop-list').slideDown();
                    }

                });

                $('body').click(function () {
                    $drop_current.removeClass('active');
                    $drop_list.slideUp();
                });

                $drop_list.find('li').click(function () {
                    let i = $(this).index();
                    let text = $(this).text();

                    $drop_list.find('li').removeClass('active');
                    $(this).addClass('active');
                    $drop_current.text(text);
                    $parent.find('option').eq(i).attr("selected", "selected");
                    $drop_list.slideUp();
                    $drop_current.removeClass('active');
                    let w_w = $(window).width();
                    if (w_w > 960) {
                        $('.filter-apply').click();
                    } else {
                        $('.filter-apply').removeClass('inactive');
                    }
                    window.location.href = $parent.find('option').eq(i).val();
                });
            });



        }

        $('.tab-btn').click(function () {
            let $parent = $(this).parents('.tabs-block');
            let index = $(this).index();

            $parent.find('.tab-body').removeClass('active').eq(index).addClass('active');
            $('.tab-btn').removeClass('active');
            $(this).addClass('active')

        });

        if ($('.banner-slider').length) {

            $('.banner-slider').each(function () {
                let $parent = $(this);

                let $image_slider = $parent.find('.splide-slider');

                let image_splide = new Splide( $image_slider[0], {
                    type   : 'loop',
                    perPage: 1,
                    autoplay: true,
                    focus: true,
                    // perMove: 5,
                    easing: 'cubic-bezier(.2,0,.28,1)',
                    gap: '5vw',
                    // padding: { left: '4px', right: '4px' },
                    speed: 700,
                    drag:  true,
                    dragMinThreshold: {
                        mouse: 0,
                        touch: 5,
                    },
                    arrows: false,
                    pagination: true,
                    // lazyLoadL: 'nearby',
                    preloadPages: 0,

                } );

                image_splide.mount();

                $parent.find('.splide-next').click(function (event) {
                    image_splide.go('>');
                });
                $parent.find('.splide-prev').click(function () {
                    image_splide.go('<');
                });

            });


        }

        if ($('.products-slider').length) {

            $('.products-slider').each(function () {
                let $parent = $(this);

                let $image_slider = $parent.find('.splide-slider');

                let image_splide = new Splide( $image_slider[0], {
                    type   : 'loop',
                    perPage: 1,
                    // fixedWidth : '19%',
                    autoWidth: true,
                    gap: '30px',
                    // perMove: 5,
                    // easing: 'cubic-bezier(.2,0,.28,1)',
                    // gap: '2px',
                    // padding: { left: '4px', right: '4px' },
                    speed: 700,
                    drag:  true,
                    dragMinThreshold: {
                        mouse: 0,
                        touch: 5,
                    },
                    arrows: false,
                    pagination: false,
                    // lazyLoadL: 'nearby',
                    preloadPages: 2,
                    breakpoints: {
                        960: {
                            gap: '0',
                        },
                    }


                } );

                image_splide.mount();

                $image_slider.find('.splide-next').click(function (event) {
                    image_splide.go('>');
                });
                $image_slider.find('.splide-prev').click(function () {
                    image_splide.go('<');
                });

            });



        }

        if ($('.drop-slider').length) {

            $('.drop-slider').each(function () {
                let $parent = $(this);

                let $image_slider = $parent.find('.splide-slider');

                let image_splide = new Splide( $image_slider[0], {
                    type   : 'loop',
                    perPage: 1,
                    // perMove: 5,
                    easing: 'cubic-bezier(.2,0,.28,1)',
                    gap: '5vw',
                    // padding: { left: '4px', right: '4px' },
                    speed: 700,
                    drag:  true,
                    dragMinThreshold: {
                        mouse: 0,
                        touch: 5,
                    },
                    arrows: false,
                    pagination: false,
                    // lazyLoadL: 'nearby',
                    preloadPages: 2,
                    flickMaxPages: 1,
                    flickPower: 1,

                } );

                image_splide.mount();

                $parent.find('.splide-next').click(function (event) {
                    image_splide.go('>');
                });
                $parent.find('.splide-prev').click(function () {
                    image_splide.go('<');
                });

            });


        }


        if ($("#range_input").length) {
            // let max = $("#range_input").parents('.simple-input').data('max');

            let max = $("#range_input").data('max');
            let min = $("#range_input").data('min');

            let checkedMax = $("#range_input").data('checkedmax');
            let checkedMin = $("#range_input").data('checkedmin');

            let from, to;

            let saveResult = function (data) {
                from = data.from;
                to = data.to;

                $('#arrFilter_P1_MIN').val(from);
                $('#arrFilter_P1_MAX').val(to);
                $('#arrFilter_P1_MIN').keyup();
            };

            $("#range_input").ionRangeSlider({
                type: "double",
                min: min,
                max: max,
                from: checkedMin,
                to: checkedMax,
                force_edges: true,
                grid: true,
                max_postfix: "+",
                postfix: " ₽",
                onChange: saveResult,
                onFinish: saveResult
            });
        }

        let datepickerOptions = {},
          datepickerStartDate = $( "#date_input" ).attr('min'),
          datepickerEndDate = $( "#date_input" ).attr('max');
        if (datepickerStartDate) {
            datepickerOptions.startDate = new Date(datepickerStartDate);
        }
        if (datepickerEndDate) {
            datepickerOptions.endDate = new Date(datepickerEndDate);
        }
        $( "#date_input" ).datepicker(datepickerOptions);

        $(this).on('change', '.address-btns input', function () {
            w_w = $(window).width();

            if ($('#add_new_address').is(':checked')) {

                if (w_w > 960) {
                    $('.new-address-block').css({'display' : 'block'})
                } else {
                    $('.new-address-block').slideDown();
                }
            } else {
                if (w_w > 960) {
                    $('.new-address-block').css({'display' : 'none'})
                } else {
                    $('.new-address-block').slideUp();
                }
            }

        });

        if ($('#yandex_map').length) {

            ymaps.ready(function () {
                var myMap = new ymaps.Map('yandex_map', {
                        center: [55.779742, 37.590928],
                        zoom: 16
                    }, {
                        searchControlProvider: 'yandex#search'
                    });

                    // Создаём макет содержимого.

                $('.contact-item').each(function () {
                    let coords = $(this).data('coords').split(',');

                    let myPlacemark = new ymaps.Placemark(coords, {
                        // hintContent: 'Собственный значок метки',
                        // balloonContent: 'Это красивая метка'
                    }, {
                        // Опции.
                        // Необходимо указать данный тип макета.
                        iconLayout: 'default#image',
                        // Своё изображение иконки метки.
                        iconImageHref: 'files/map_pin.svg',
                        // Размеры метки.
                        iconImageSize: [38, 42],
                        // Смещение левого верхнего угла иконки относительно
                        // её "ножки" (точки привязки).
                        iconImageOffset: [-19, -21]
                    });

                    myMap.geoObjects
                        .add(myPlacemark)

                });

                myMap.setBounds(myMap.geoObjects.getBounds(), {
                    checkZoomRange: true,
                    zoomMargin: 35
                });

                $(document).on('click', '.mab-btn', function () {
                    let coords = $(this).parents('.contact-item').data('coords').split(',');
                    myMap.setCenter(coords , 16);
                    document.getElementById('yandex_map').scrollIntoView({ behavior: 'smooth', block: 'center' });
                });

            });

        }

        $('.view-all-bnt').click(function () {
            $(this).toggleClass('active');
            $('.hidden-descr').slideToggle();

        });

        $('.more-details-btn').click(function () {
            $(this).toggleClass('active');
            $('.more-info-acc-block').slideToggle();

        });

        if ($('#price_chart').length) {
            var xValues = ['July 20', 'April 21', 'Now'];

            new Chart("price_chart", {
                type: "line",
                data: {
                    labels: xValues,
                    datasets: [{
                        data: [860,7830,2478],
                        pointBackgroundColor: ["rgba(0,0,255,1)", "rgba(255,0,0,1)", "rgba(0,255,0,1)"],
                        fill: false
                    }],
                },
                options: {
                    legend: {display: false},
                    point: {
                        borderWidth: 0,

                    },
                    line: {
                        borderWidth: 1,
                        borderColor: "black",

                    }
                }
            });

        }

        $('.personal-edit-bnt').click(function () {
            $('.personal-info-block').find('input').attr('disabled', false);
            $('.personal-info-block').find('textarea').attr('disabled', false);
            $('.submit-block').addClass('active');
        });

        $(document).on('click', '.show-details', function () {
            $(this).toggleClass('active');
            $('.order-details-acc').slideToggle();
            if ($(this).hasClass('active')) {
                let target_pos = $(this).offset().top - 150;
                $("html, body").stop().animate({scrollTop: target_pos}, 500, 'swing', function() {
                });

            } else {
                $("html, body").stop().animate({scrollTop: 0}, 500, 'swing', function() {
                });
            }
        });

        $('.dropdown-item').on('mouseenter', function () {
            let target_id = $(this).data('drop');
            if (target_id === 'brand_info' && $(window).width() < 960) {
              return;
            }

            $('#drop_menu_block').find('.dropdown-menu').each(function () {
                let $this = $(this);
                $this.removeClass('active');
                let drop_id = $(this).data('drop');

                if (target_id == drop_id) {
                    $this.addClass('active');
                }
            });
        });

        $('.dropdown-menu').on('mouseleave', function () {
            $('#drop_menu_block').find('.dropdown-menu').each(function () {
                $(this).removeClass('active');
            });
        });

        $('.main-nav li').on('mouseenter', function () {
            if (!$(this).hasClass('dropdown-item')) {
                $('#drop_menu_block').find('.dropdown-menu').each(function () {
                    $(this).removeClass('active');
                });

            }
        });

        $('.back-drop-btn').click(function () {
            $('#drop_menu_block').find('.dropdown-menu').each(function () {
                $(this).removeClass('active');
            });
        });

        $('.s-pop-close').click(function () {
            $('.sizes-block').removeClass('s-pop-active');
            $('.product-ctrls').removeClass('s-pop-active');
            $('body').removeClass('no-scroll');
        });

        $(document).on('click', '#LoginPopup .pop-close', function () {
            $('#AuthFormInPopup').show();
            $('#EnterCodeInPopup').hide();
            $('#LoginPopup').find('input').val('');
        });

        $(document).on('click', '.pop-close', function () {
            $(this).parents('.popup').removeClass('active');
            $('.blur-body').removeClass('active_blur');
            $('body').removeClass('no-scroll');
        });

        $('.ask-sizes').click(function (event) {
            event.preventDefault();
            event.stopPropagation();
            try {
              window.pfWidget.open();
            } catch (e) {
              console.log(e);
            }
            // $('.ask-sizes-popup').addClass('active');
            // $('.blur-body').addClass('active_blur');
            // $('body').addClass('no-scroll');
            // $('.sizes-table-popup').removeClass('active');

        });

        $('.sizes-table-btn').click(function (event) {
            event.preventDefault();
            event.stopPropagation();
            $('.sizes-table-popup').addClass('active');
            $('.blur-body').addClass('active_blur');
            $('body').addClass('no-scroll');

        });

        $('.share-pop-btn').click(function (event) {
            event.stopPropagation();
            $('.share-popup').addClass('active');
            $('.blur-body').addClass('active_blur');
            $('body').addClass('no-scroll');

        });

        $('.certificate-btn').click(function (event) {
            event.stopPropagation();
            event.preventDefault();
            $('.certificate-popup').addClass('active');
            $('.blur-body').addClass('active_blur');
            $('body').addClass('no-scroll');
            $(this).addClass('disabled-btn').text('сертификат применен');
        });

        $('.return-link').click(function (event) {
            event.stopPropagation();
            event.preventDefault();
            $('.return-popup').find('.response').hide();
            $('.return-popup').find('form').show();
            var orderBlock = jQuery(this).parent().parent().find('.vendor-code');
            var orderID = orderBlock.data('order-id');
            var orderNumber = orderBlock.data('order-number');
            $('.return-popup').find('.order-number').html(orderNumber);
            $('.return-popup').find('input[name="order_id"]').val(orderID);
            $('.return-popup').find('input[name="order_number"]').val(orderNumber);
            $('.return-popup').addClass('active');
        });

        $('.h-page-pop-close').click(function () {
            $('.h-page-popup').removeClass('active');
            $('.blur-body').removeClass('active_blur');
            $('body').removeClass('no-scroll');
        });

        $(document).on('click', '.cart-btn', function (event) {
            event.preventDefault();
            $('#cart_popup').addClass('active');
            $('.blur-body').addClass('active_blur');
            $('body').addClass('no-scroll');
            if ($('.total-counter').length) {
                total_counter();
            }
        });

        /*$('.js-cart-link').click(function (event) {
            event.preventDefault();
            event.stopPropagation();
            $('#delivery_popup').addClass('active');
            $('.blur-body').addClass('active_blur');
            $('body').addClass('no-scroll');
        });*/

        $(document).on('click', '.search-btn', function (event) {
            event.preventDefault();
            $('.dropdown-menu').trigger('mouseleave');
            $('#search_popup').addClass('active');
            $('.page.blur-body').addClass('active_blur');
            $('.footer.blur-body').addClass('active_blur');
            $('body').addClass('no-scroll');
        });

        // $('#search_popup input').on('change', function () {
        //     let val = $(this).val();
        //     if (val) {
        //         $.ajax("/local/api/search/head.php", {
        //             data: "q="+val,
        //             type: "POST",
        //             success: function(mess) {
        //                 $('.search-results').html(mess);
        //             }
        //         });
        //         $('.search-results').slideDown();
        //     } else {
        //         $('.search-results').slideUp();
        //     }
        // });

        $('.page').click(function (e) {
            if ($(e.target).hasClass('search-button')) {
              return;
            }
            $('#search_popup').removeClass('active');
            $('.page.blur-body').removeClass('active_blur');
            $('.footer.blur-body').removeClass('active_blur');
            $('body').removeClass('no-scroll');
            $('.title-search-result').hide();
        });

        $('.search-close').click(function () {
            $('#search_popup').removeClass('active');
            $('.page.blur-body').removeClass('active_blur');
            $('.footer.blur-body').removeClass('active_blur');
            $('body').removeClass('no-scroll');
            $('.title-search-result').hide();
        });

        $('.drop-subscribe-btn').click(function (event) {
            event.preventDefault();
            $(this).addClass('disabled-btn').text('вы подписаны');
            $('.drop-popup').addClass('active');

            setTimeout(function () {
                $('.drop-popup').removeClass('active');
            }, 5000);
        });

        $('.js-copy-btn').click(function () {
            /* Get the text field */
            var copyText = document.getElementById("copy_link");

            /* Select the text field */
            copyText.select();
            copyText.setSelectionRange(0, 99999); /* For mobile devices */

            /* Copy the text inside the text field */
            navigator.clipboard.writeText(copyText.value);
            copyText.val('Ссылка скопирована!').addClass('done');
        });

        $('.select_all input').on('change', function () {
            if ($('.select_all input').is(':checked')) {
                $('.product-return-checkboxes').find('input').prop('checked', true);
            } else {
                $('.product-return-checkboxes').find('input').prop('checked', false);
            }
        });

        $('.edit-address-btn').click(function () {
            $(this).parent().find('input').attr('disabled', false);

        });

        $(document).on('click', '.profile-btn', function (event) {
            event.preventDefault();
            event.stopPropagation();
            $('.profile-nav').toggleClass('active');
        });


        $('.lang-btn').click(function (event) {
            event.preventDefault();
            event.stopPropagation();
            if (event.target.hasAttribute("href")) {
                window.location.href = event.target.getAttribute("href");
            }
            $('.lang-list').toggleClass('active');
        });

        $(document).click(function () {
            $('.profile-nav').removeClass('active');
            $('.lang-list').removeClass('active');
        });

        $('.fav-link').click(function (event) {
            event.preventDefault();
            $(this).toggleClass('active');
        });

        function total_counter() {
            let $total_block = $('.total-counter');
            $total_block.empty();
            let $total_parent = $total_block.parent();
            let total = $total_block.data('total');
            let total_str = '' + total;
            let len = total_str.length;
            let digit_change_timeout = 200;
            let total_start_time = 200;
            for (let i = 0; i < len; i++ ) {
                if ((i + 1) % 3 == 0) {
                    $total_block.prepend('<div class="digit-item format-margin"><div class="sizer">0</div><div class="digits-container"><div class="digit active">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div></div></div>')
                } else {
                    $total_block.prepend('<div class="digit-item"><div class="sizer">0</div><div class="digits-container"><div class="digit active">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div></div></div>')
                }
            }

            setTimeout(function () {
                $total_parent.addClass('active');
                for (let i = len; i > 0; i-- ) {
                    let digit_cont = $total_block.find('.digit-item').eq(i - 1).find('.digits-container');
                    let target = total_str.charAt(i - 1);

                    setTimeout(function () {
                        digit_rotate(digit_cont, target, digit_change_timeout );
                    }, total_start_time / i);
                }

            }, 1000);

        }

        function digit_rotate (container, target, timeout) {

            for (let i = 0; i < 10; i++ ) {
                let $digit = container.find('.digit').eq(i);
                let num = parseInt($digit.text());
                //console.log(num != target);

                if (num != target) {
                    $digit.addClass('go-througth');
                    setTimeout(function () {
                        $digit.addClass('active');
                        setTimeout(function () {
                            $digit.addClass('denied');
                        }, timeout)

                    }, timeout*(i + 1));

                } else {
                    setTimeout(function () {
                        $digit.addClass('active');
                    }, timeout*(i + 1));


                    break;
                }

            }
        }

        /*$('.count-btn').click(function () {
            let $this_btn = $(this);
            let $parent = $this_btn.parents('.count-input-block');
            let $btns = $parent.find('.count-btn');

            let $input = $parent.find('input');
            let value = Number($input.val());
            let max = $parent.data('max');


            if ($this_btn.hasClass('minus-btn')) {
                if (value > 1) {
                    $btns.attr('disabled', false);
                    let new_val = value - 1;
                    $input.val(new_val);
                    if (new_val == 1) {
                        $this_btn.attr('disabled', true);
                    }
                } else {
                    $this_btn.attr('disabled', true);
                }

            }
            if ($this_btn.hasClass('plus-btn')) {
                if (value < max) {
                    $btns.attr('disabled', false);
                    let new_val = value + 1;
                    $input.val(new_val);
                    if (new_val == max) {
                        $this_btn.attr('disabled', true);
                    }
                } else {
                    $this_btn.attr('disabled', true);
                }

            }

        });*/

        /*$('.plus-btn').click(function () {
            add_to_cart_animation(1);

        });*/

        function add_to_cart_animation(num) {
            let $btn = $('.cart-btn');

            $btn.addClass('started');

            setTimeout(function () {
                $btn.removeClass('started').addClass('anim_1');
            }, 10);
            setTimeout(function () {
                $btn.removeClass('anim_1').addClass('anim_2');
            }, 300);
            setTimeout(function () {
                $btn.removeClass('anim_2').addClass('active');
            }, 600);

        }

        if($('.custom-banner-slider').length){
            $('.custom-banner-slider').each(function () {
                let $slider = $(this);

                custom_banner_slider($slider);
            });
        }

        function custom_banner_slider(slider) {
            let $slider = slider;
            let leng = $slider.find('.image-block').length;
            let $current = $slider.find('.active');
            let timeout = parseInt($current.data('timeout'))*1000;
            if (timeout < 400) {
                timeout = 400;
            }

            //console.log(timeout);

            let next_i = $current.index() + 1;

            if(next_i >= leng){
                next_i = 0;
            }
            //console.log(leng);
            //console.log(next_i);

            let $next = $slider.find('.image-block').eq(next_i);

            setTimeout(function () {
                $next.addClass('next');
            }, 10);

            setTimeout(function () {
                $current.addClass('gone').removeClass('active');
                $next.addClass('active');
            }, timeout);
            setTimeout(function () {
                $current.removeClass('gone');
                $next.removeClass('next');

                custom_banner_slider($slider);
            }, timeout + 300);

        }

        $('.js-drop-timer').each(function () {

            let $timer = $(this);

            let countDownDate = new Date($timer.data('targettime')).getTime();


            let x = setInterval(function() {

                // Get today's date and time
                var now = new Date().getTime();
                // Find the distance between now and the count down date
                var distance = countDownDate - now;


                // Time calculations for days, hours, minutes and seconds
                var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                var seconds = Math.floor((distance % (1000 * 60)) / 1000);

                // Display the result in the element with id="demo"
                $timer[0].innerHTML = days + "д " + hours + "ч "
                    + minutes + "м " + seconds + "с ";

                // If the count down is finished, write some text
                if (distance < 0) {
                    clearInterval(x);
                    $timer[0].innerHTML = '';
                }
            }, 1000);
        });


        $(document).on('click', '.ajax_pop_link', function (event) {
            event.preventDefault();

            let url = $(this).attr('href');

            $.ajax({
                url: url,
                context: $('#a_pop_container'),
                type: 'GET',
                success: function (data) {
                    $(this).html(data);
                },
                complete: function () {
                    $('#a_pop_container').find('.popup').addClass('active');
                    $('.blur-body').addClass('active_blur');
                    $('body').addClass('no-scroll');

                }
            });

        });


        $('.upload-image').on('change', function () {
            const [file] = $('.upload-image')[0].files
            if (file) {
                $('.uploaded-file-image')[0].src = URL.createObjectURL(file);
                $('.uploaded-file-image').addClass('active');
            }

        });

/*
if ($(window).width() < 960) {
    $('.dropdown-item > a').on('click', function (e) {
        let $item = $(this).closest('.dropdown-item');
        let target_id = $item.data('drop');
        let $dropdown = $('#drop_menu_block').find('.dropdown-menu[data-drop="' + target_id + '"]');

        // если подменю ещё не активно — открываем его и блокируем переход
        if (!$dropdown.hasClass('active')) {
            e.preventDefault();
            $('#drop_menu_block .dropdown-menu').removeClass('active');
            $dropdown.addClass('active');
        }
        // если уже открыто — происходит обычный переход
    });
}
*/
if ($(window).width() < 960) {
    $('.dropdown-item.has-submenu .dropdown-link').each(function () {
        let tappedOnce = false;

        $(this).on('touchstart click', function (e) {
            e.preventDefault();
            e.stopPropagation();

            let $item = $(this).closest('.dropdown-item');
            let target_id = $item.data('drop');
            let $dropdown = $('#drop_menu_block').find('.dropdown-menu[data-drop="' + target_id + '"]');

            if (!$dropdown.hasClass('active')) {
                $('#drop_menu_block .dropdown-menu').removeClass('active');
                $dropdown.addClass('active');
                tappedOnce = true;

                setTimeout(() => tappedOnce = false, 500);
            } else {
                const href = $(this).data('href');
                if (href) window.location.href = href;
            }
        });
    });
}




    });
})(jQuery);