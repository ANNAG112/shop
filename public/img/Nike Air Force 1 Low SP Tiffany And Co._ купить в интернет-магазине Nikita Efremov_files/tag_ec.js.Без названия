(()=>{"use strict";let e=function(e){return e.CreateOrderClick="create_order_click",e.CreateOrderSubmit="create_order_submit",e.CreateOrderRequest="create_order_request",e.CreateOrderResponse="create_order_response",e.OrderThankYouPage="order_thank_you_page",e}({});class t{constructor(e){this.id=e}}class r extends t{constructor(e,t){super(e),this.ecomEvent=t}}class s extends t{}class o extends t{}class c extends r{constructor(t,r,s){super(t,s||e.CreateOrderClick),this.selectors=r}apply(e){const t=e.target;if(t instanceof Element){return this.selectors.flatMap((e=>[e,`${e} *`])).some((e=>t.matches(e)))}return!1}}class n extends c{constructor(){super("1c-bitrix-click",["#bx-soa-orderSave a",".btn-order-save"])}}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function u(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=a(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==a(t)?t:t+""}function i(e,t,r){return(t=u(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class l extends r{constructor(t,r,s){super(t,s||e.OrderThankYouPage),this.id=t,this.views=r,this.event=s,i(this,"isPageReloaded",void 0),this.isPageReloaded=window.performance.navigation&&1===window.performance.navigation.type||window.performance.getEntriesByType("navigation").some((e=>"type"in e&&"reload"===e.type))}apply(){return this.views.some((({url:e,referrer:t})=>{const r=!e||("string"==typeof e?document.location.href.includes(e):e.test(document.location.href)),s=this.isPageReloaded?"":document.referrer,o=!t||("string"==typeof t?s.includes(t):t.test(s));return r&&o}))}}class p extends l{constructor(){super("1c-bitrix-page-view",[{url:"/order/?ORDER_ID=",referrer:"/order/"}])}}class d extends r{static matchRequest(e,t){const r=!t.url||("string"==typeof t.url?e.url.includes(t.url):t.url.test(e.url)),s=!t.method||e.method===t.method,o=!t.checkBody||!!e.body&&t.checkBody(e.body);return r&&s&&o}constructor(t,r,s){super(t,s||e.CreateOrderRequest),this.patterns=r}apply(e){return!e.response&&this.patterns.some((t=>d.matchRequest(e.request,t)))}}class h extends r{constructor(t,r,s){super(t,s||e.CreateOrderResponse),this.patterns=r}apply({request:e,response:t}){return!!t&&this.patterns.some((r=>this.matchResponse(e,t,r)))}matchResponse(e,t,r){const s=!r.request||d.matchRequest(e,r.request),o=!r.status||t.status===r.status;return s&&o}}const m=[{url:"bitrix/components/bitrix/sale.order.ajax/ajax.php",method:"POST"}];class w extends d{constructor(){super("1c-bitrix-request",m)}}class f extends h{constructor(){super("1c-bitrix-response",m.map((e=>({request:e,status:200}))))}}class y extends r{constructor(t,r,s){super(t,s||e.CreateOrderSubmit),this.selectors=r}apply(e){const t=e.target;return t instanceof Element&&this.selectors.some((e=>t.matches(e)))}}class v extends y{constructor(){super("1c-bitrix-submit",['[action="/order/"]','[name="ORDER_FORM"]',"#bx-soa-order-form"])}}const b=e=>void 0!==e;class x extends s{constructor(e,t){super(e),this.selectors=t}apply(){const e=this.selectors.flatMap((e=>[...document.querySelectorAll(e)])).map((e=>e.textContent?(e=>{if(!e)return;const t=e.match(/[\d.,\s]+/)?.[0]?.replace(/\s/g,"");if(!t)return;const r=t.includes(","),s=t.includes(".");if(r&&s)return t.lastIndexOf(",")>t.lastIndexOf(".")?parseFloat(t.replace(/\./g,"").replace(",",".")):parseFloat(t.replace(/,/g,""));return r?parseFloat(t.replace(",",".")):parseFloat(t)})(e.textContent):void 0)).filter(b).sort();return e[e.length-1]}}class k extends o{constructor(e,t){super(e),this.selectors=t}apply(){const e=this.selectors.flatMap((e=>[...document.querySelectorAll(e)])),t=e.length?e[0]:void 0;return t?.textContent??void 0}}const g=[".bx-soa-cart-total-line-total .bx-soa-cart-d"];class _ extends k{constructor(){super("1c-bitrix-click-raw-revenue",g)}}class q extends x{constructor(){super("1c-bitrix-click-parsed-revenue",g)}}class E extends c{constructor(){super("cs-cart-click",[".litecheckout__submit-btn",'[name="dispatch[checkout.place_order]"]',"#litecheckout_place_order"])}}class C extends l{constructor(){super("cs-cart-page-view",[{url:"index.php?dispatch=checkout.complete",referrer:"index.php?dispatch=checkout.checkout"}])}}class S extends y{constructor(){super("cs-cart-submit",['[name="litecheckout_payments_form"]',"#litecheckout_payments_form",'[action*="dispatch=checkout.place_order"','[data-ca-lite-checkout-element="checkout-form"]'])}}const R=[".ty-checkout-summary__total-sum"];class O extends k{constructor(){super("cs-cart-click-raw-revenue",R)}}class T extends x{constructor(){super("cs-cart-click-parsed-revenue",R)}}class L extends c{constructor(){super("insales-click",[".co-button--checkout","#create_order"])}}class j extends l{constructor(){super("insales-page-view",[{url:"/orders/",referrer:/\/new_order$/}])}}class P extends y{constructor(){super("insales-submit",["#order_form",".co-checkout-order_form"])}}const $=[".co-basket_total-price"];class M extends k{constructor(){super("insales-click-raw-revenue",$)}}class H extends x{constructor(){super("insales-click-parsed-revenue",$)}}const D=[".co-price"];class U extends k{constructor(){super("insales-page-view-raw-revenue",D)}}class I extends x{constructor(){super("insales-page-view-parsed-revenue",D)}}class X extends c{constructor(){super("joomla-click",['[name="finish_registration"]','[value="Подтвердить заказ"]',".nevigen-onestepcheckout-finish button",".button_order_finish","#button_order_finish","#cart-button-finish"])}}class A extends l{constructor(){super("joomla-page-view",[{url:"checkout/finish",referrer:"checkout"},{url:"/finish",referrer:/\/step\d/}])}}class F extends y{constructor(){super("joomla-submit",['.jshop [name="form_finish"]',"#nevigenOneStepCheckout",'[name="nevigenOneStepCheckout"]',"#oneStepCheckoutForm",'[name="oneStepCheckoutForm"]','[action*="/qcheckout/save"]',"#payment_form",'[name="quickCheckout"]'])}}const N=[".jshop_subtotal .total .value","#total_cart .total .value",".totalvalue"];class G extends k{constructor(){super("joomla-click-raw-revenue",N)}}class B extends x{constructor(){super("joomla-click-parsed-revenue",N)}}class W extends c{constructor(){super("megagroup-click",[".shop2-btn"])}}class z extends y{constructor(){super("megagroup-submit",['[action*="/cart?action=save"]',".shop2-cart-order-form"])}}const J=[".cart-total__item.last_item .cart-total__body"];class Y extends k{constructor(){super("megagroup-click-raw-revenue",J)}}class K extends x{constructor(){super("megagroup-click-parsed-revenue",J)}}class Q extends c{constructor(){super("opencart-click",["#simplecheckout_button_confirm",'[data-onclick="createOrder"]',"#button-confirm","#confirm_checkout","#button_checkout","#button-go"])}}class V extends l{constructor(){super("opencart-page-view",[{url:"/index.php?route=checkout/success"},{url:"/order-success/"}])}}const Z=[{url:"index.php?route=checkout/cart/createOrder"},{url:"index.php?route=checkout/simplecheckout",method:"POST"},{url:"index.php?route=octemplates/module/oct_popup_purchase/makeOrder"}];class ee extends d{constructor(){super("opencart-request",Z)}}class te extends h{constructor(){super("opencart-response",Z.map((e=>({request:e,status:200}))))}}class re extends y{constructor(){super("opencart-submit",["#oct_purchase_form"])}}class se extends o{constructor(){super("opencart-request-url")}apply(e){return e.request.url||void 0}}const oe=["#total_total .simplecheckout-cart-total-value","#unicheckout .total","#total_total"];class ce extends k{constructor(){super("opencart-raw-revenue-selector-data-collector",oe)}}class ne extends x{constructor(){super("opencart-parsed-revenue-selector-data-collector",oe)}}class ae extends d{constructor(){super("tilda-request-factor-collector",[{url:"/procces",method:"POST",checkBody:e=>e.includes("tildaspec-formname=Cart")}])}}class ue extends c{constructor(){super("tilda-submit-selector-factor-collector",['[class*="cartpage-form"] .t-submit','[class*="orderform"] .t-submit'])}}const ie=['[class*="cartwin-totalamount-content"] [class*="cartwin-prodamount-price"]'];class le extends k{constructor(){super("tilda-raw-revenue-selector-data-collector",ie)}}class pe extends x{constructor(){super("tilda-parsed-revenue-selector-data-collector",ie)}}class de extends c{constructor(){super("webasyst-click",[".js-submit-order-button"])}}class he extends l{constructor(){super("webasyst-page-view",[{url:"/checkout/success",referrer:"/order"}])}}const me={url:"order/create",method:"POST"};class we extends d{constructor(){super("webasyst-request",[me])}}class fe extends h{constructor(){super("webasyst-response",[{request:me,status:200}])}}const ye=[".wa-item-total .wa-price"];class ve extends k{constructor(){super("webasyst-click-raw-revenue",ye)}}class be extends x{constructor(){super("webasyst-click-parsed-revenue",ye)}}class xe extends c{constructor(){super("woocommerce-click-selector-factor-collector",[".wc-block-components-checkout-place-order-button",'[name="woocommerce_checkout_place_order"]',"#place_order"])}}const ke=[{url:"/wp-json/wc/store/v1/checkout",method:"POST"},{url:"?wc-ajax=checkout",method:"POST"}];class ge extends d{constructor(){super("woocommerce-request-factor-collector",ke)}}class _e extends h{constructor(){super("woocommerce-response",ke.map((e=>({request:e,status:200}))))}}const qe=[".wc-block-components-totals-item__value",".order-total .woocommerce-Price-amount"];class Ee extends k{constructor(){super("woocommerce-raw-revenue-selector-data-collector",qe)}}class Ce extends x{constructor(){super("woocommerce-parsed-revenue-selector-data-collector",qe)}}const Se={url:"/wp-admin/admin-ajax.php?action=process_order"};class Re extends d{constructor(){super("wordpress-request",[Se])}}class Oe extends h{constructor(){super("wordpress-response",[{request:Se,status:200}])}}function Te(e){return!!e.value}class Le{constructor(e,t,r){this.factorCollectors=e,this.revenueCollectors=t,this.dataCollectors=r,i(this,"options",void 0)}start(e){this.options=e}stop(){}processCollectors(e,t,r){return e.map((e=>{try{return{id:e.id,value:e.apply(t)}}catch(t){return this.handleError(t,r),{id:e.id,value:void 0}}}),[]).filter(Te)}processEvent(e){const t=this.options?.transport;if(!t)throw new Error("empty transport");let r,s;var o;(o=this.factorCollectors.map((e=>e.ecomEvent)),[...new Set(o)]).map((o=>{const c=this.processCollectors(this.factorCollectors.filter((e=>e.ecomEvent===o)),e,"f.c");c.length&&(r||s||(r=this.processCollectors(this.revenueCollectors,e,"r.c"),s=this.processCollectors(this.dataCollectors,e,"d.c")),t.sendData({[o]:{factors:c.map((e=>e.id)),revenue:r?.reduce(((e,t)=>({...e,[t.id]:t.value})),{}),_internal:s?.reduce(((e,t)=>({...e,[t.id]:t.value})),{})}}))}))}handleError(e,t){try{this.options?.transport&&this.options.transport.sendError(e,t)}catch(e){}}}class je extends Le{constructor(...e){super(...e),i(this,"clickCb",void 0)}start(e){super.start(e),this.clickCb=e=>{try{this.processEvent(e)}catch(e){this.handleError(e,"cl")}},window.document.addEventListener("click",this.clickCb)}stop(){this.clickCb&&window.document.removeEventListener("click",this.clickCb)}}class Pe extends Le{constructor(...e){super(...e),i(this,"urlWatchTimeout",void 0),i(this,"currentUrl",void 0)}start(e){super.start(e),this.currentUrl=location.href,this.urlWatchTimeout=setInterval((()=>{try{location.href!==this.currentUrl&&(this.currentUrl=location.href,this.processEvent(void 0))}catch(e){this.handleError(e,"u.t")}}),100),this.processEvent(void 0)}stop(){this.urlWatchTimeout&&clearTimeout(this.urlWatchTimeout)}}function $e(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}const Me=e=>{const t={};return e instanceof Headers?(e.forEach(((e,r)=>{t[r]=e})),t):Array.isArray(e)?(e.forEach((e=>{t[e[0]]=e[1]})),t):"object"==typeof e?e:{}},He=e=>"string"==typeof e?e:void 0,De=[e=>{const t=e.toString();return He(t)},e=>{const t=e.toJSON();return He(t)},e=>{const t=JSON.stringify(e);return He(t)}],Ue=e=>{let t;if(t="string"==typeof e?e:e instanceof Request&&e.url?e.url:void 0===e?"undefined":(e=>{let t;return De.map((r=>{if(!t)try{t=r(e)}catch(e){}})),t})(e),!t&&""!==t){const r=(e=>De.map((t=>{try{return{name:t.name,value:t(e)}}catch(e){return{name:t.name,value:"error"}}})))(e);throw new Error(`Fetch url error, parsedUrl: ${t}, type: ${typeof e}, content: ${JSON.stringify(r)}`)}return t},Ie=(e,t,r,s)=>{const o=Ue(r),c=((e,t)=>t?.method?t.method:"string"==typeof e||e instanceof URL?"GET":e?.method||"GET")(r,s),n=((e,t)=>{let r;return r=t?.headers?t.headers:"string"==typeof e||e instanceof URL?{}:e?.headers||{},Me(r)})(r,s),a=s?.body?.toString();return{url:o,method:c,headers:n,body:a,timestamp:t,requestId:e}},Xe=(e,t,r)=>{const s=window.fetch;return window.fetch=async function(...o){let c,n,a;try{c=$e(),n=Date.now(),a=Ie(c,n,...o),e(a)}catch(e){try{r?.(e,"f.rq")}catch(e){}}return s.apply(this,o).then((async e=>{const s=[];try{const o=e.clone();if(s.push("resp cloned"),c&&n&&a){s.push("before parse resp");const e=await(async(e,t,r,s)=>{let o;try{o=await r.text()}catch(e){e instanceof Error&&"AbortError"===e.name||"cors"===r.type||s?.(e,`f.rs.d - status: ${r.status}, statusText: ${r.statusText}, ok: ${r.ok}, bodyUsed: ${r.bodyUsed}, redirected: ${r.redirected}, type: ${r.type}, url: ${r.url}`)}return{status:r.status,statusText:r.statusText,headers:Me(r.headers),body:o,timestamp:Date.now(),duration:Date.now()-t,requestId:e}})(c,n,o,r);s.push("before call resp cb"),t(a,e),s.push("after call resp cb")}}catch(e){try{r?.(e,`f.rs, ${s.join(", ")}`)}catch(e){}}return e})).catch((e=>{try{c&&n&&a&&t(a,((e,t,r)=>({status:0,statusText:r.message,headers:{},timestamp:Date.now(),duration:Date.now()-t,requestId:e}))(c,n,e))}catch(e){try{r?.(e,"f.rs.e")}catch(e){}}throw e}))},()=>{window.fetch=s}},Ae=new WeakMap,Fe=(e,t,r)=>{const s="string"==typeof r?r:r.toString();if(!s&&""!==s){let e="";try{e=`stringify: ${JSON.stringify(r)}`}catch(t){e=`toString: ${r.toString()}`}throw new Error(`Xhr url error, parsedUrl: ${s}, type: ${typeof r}, content: ${e}`)}Ae.set(e,{url:s,method:t,headers:{},timestamp:Date.now(),requestId:$e()})},Ne=(e,...t)=>{const[r]=t,s=Ae.get(e);if(s)return s.body=r?.toString(),s};function Ge(e){const t={};if(!e)return t;const r=e.split("\r\n");for(let e=0;e<r.length;e++){const s=r[e],o=s.indexOf(": ");if(o>0){const e=s.substring(0,o),r=s.substring(o+2);t[e]=r}}return t}const Be=(e,t,r)=>({status:r.status,statusText:r.statusText,headers:Ge(r.getAllResponseHeaders()),body:String(r.response),timestamp:Date.now(),duration:Date.now()-t,requestId:e});const We=new Map;let ze,Je;function Ye(e,t){if(!ze)try{ze=function(e,t,r){const s=XMLHttpRequest.prototype.open,o=XMLHttpRequest.prototype.send;try{XMLHttpRequest.prototype.open=function(...e){try{const[t,r]=e;Fe(this,t,r)}catch(e){try{r?.(e,"x.rq")}catch(e){}}s.apply(this,e)},XMLHttpRequest.prototype.send=function(...s){let c;try{if(c=Ne(this,...s),c){e(c);const s=()=>{try{if(!c)return;const e=Be(c.requestId,c.timestamp,this);t(c,e),this.removeEventListener("load",s),this.removeEventListener("error",s),this.removeEventListener("abort",s)}catch(e){try{r?.(e,"x.rs")}catch(e){}}};this.addEventListener("load",s),this.addEventListener("error",s),this.addEventListener("abort",s)}}catch(e){try{r?.(e,"x.s")}catch(e){}}o.apply(this,s)}}catch(e){XMLHttpRequest.prototype.open=s,XMLHttpRequest.prototype.send=o}return()=>{XMLHttpRequest.prototype.open=s,XMLHttpRequest.prototype.send=o}}((e=>Ke({request:e})),((e,t)=>Ke({request:e,response:t})),t)}catch(e){t?.(e,"x.i")}if(!Je)try{Je=Xe((e=>Ke({request:e})),((e,t)=>Ke({request:e,response:t})),t)}catch(e){t?.(e,"f.i")}return We.set(e,[e,t]),()=>{try{We.delete(e),We.size||(ze?.(),Je?.(),ze=void 0,Je=void 0)}catch(e){t?.(e,"u")}}}function Ke(e){We.forEach((([t,r])=>{try{t(e)}catch(e){r?.(e,"n")}}))}const Qe=[/^mc.yandex.(ru|az|by|co.il|com|com.am|com.ge|com.tr|ee|fr|kg|kz|lt|lv|md|tj|tm|uz)/,/^mc.webvisor.(com|org)/,/^yastatic.net/,/.*googletagmanager.com/,/.*google-analytics.com/,/.*analytics.google.com/,/.*g.doubleclick.net/,/.*googleadservices.com/,/.*google.(com|ru)/,/^(www.)?facebook.com/,/^connect.facebook.net/];class Ve extends Le{constructor(...e){super(...e),i(this,"unsubcribeRequests",void 0)}start(e){super.start(e),this.unsubcribeRequests=Ye((e=>{try{this.processEvent(e)}catch(e){this.handleError(e,"r.c")}}),((e,t)=>this.handleError(e,`r.o.${t}`)))}processEvent(e){if(Qe.every((t=>!t.test(e.request.url))))return super.processEvent(e)}stop(){this.unsubcribeRequests?.()}}class Ze extends Le{constructor(...e){super(...e),i(this,"submitCb",void 0)}start(e){super.start(e),this.submitCb=e=>{try{this.processEvent(e)}catch(e){this.handleError(e,"sb")}},window.document.addEventListener("submit",this.submitCb)}stop(){this.submitCb&&window.document.removeEventListener("submit",this.submitCb)}}class et{}let tt=function(e){return e.Params="params",e.ReachGoal="reachGoal",e.Hit="hit",e}({});class rt{static visitParams(e,t,r){"undefined"!=typeof ym&&(r?ym(e,tt.Params,t,r):ym(e,tt.Params,t))}static reachGoal(e,t,r){"undefined"!=typeof ym&&(r?ym(e,tt.ReachGoal,t,r):ym(e,tt.ReachGoal,t))}static hit(e,t,r){ym(e,tt.Hit,t,r)}static getCounters(){const e=Ya._metrika.getCounters();return Array.isArray(e)?e.map((e=>{if("object"==typeof(t=e)&&null!==t&&"number"==typeof e.id){const t=Number(e.type);return{id:e.id,type:isNaN(t)?void 0:t,accurateTrackBounce:!!e.accurateTrackBounce,clickmap:!!e.clickmap,trackHash:!!e.trackHash,trackLinks:!!e.trackLinks,webvisor:!!e.webvisor}}var t})).filter(b):[]}}class st extends et{sendData(e){this.send(e)}sendError(e,t){let r;r=e instanceof Error?{name:e.name,message:e.message,stack:e.stack,scope:t}:{name:"Unknown error",message:String(e),scope:t},this.send({error:r})}send(e){rt.getCounters().map((t=>{try{rt.visitParams(t.id,{__ym:{ec:e}})}catch(e){}}))}}const ot=!1;try{ot;const e=new st,t=new Pe([new j,new V,new A,new he,new C,new p],[new I],[new U]),r=new je([new xe,new ue,new L,new Q,new X,new de,new W,new E,new n],[new Ce,new pe,new H,new ne,new B,new be,new K,new T,new q],[new Ee,new le,new M,new ce,new G,new ve,new Y,new O,new _]),s=new Ze([new P,new re,new F,new z,new S,new v],[new B,new K,new T,new q],[new G,new Y,new O,new _]),o=new Ve([new ge,new _e,new ae,new Re,new Oe,new ee,new te,new we,new fe,new w,new f],[],[new se]);[t,r,s,o].map((t=>t.start({transport:e})))}catch(e){try{(new st).sendError(e,"g")}catch(e){}}})();